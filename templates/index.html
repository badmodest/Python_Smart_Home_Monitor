<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='/favicon.ico') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/styles.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/framework7-icons/css/framework7-icons.css">
  <script src="https://kit.fontawesome.com/7e84202197.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>Smart Home Monitor</title>
  
</head>
<body>
  <div id="notification"></div>
  <div class="bottom-menu">
    <a href="#" class="menu-item"><i class="fas fa-home fa-2x"></i></a>
    <a href="/overview" class="menu-item"><i class="fas fa-chart-bar fa-2x"></i></a>
    <a href="/charts" class="menu-item"><i class="fas fa-tachometer-alt fa-2x"></i></a>
    <a href="/login" action="/login" class="menu-item"><i class="fas fa-sign-out-alt fa-2x"></i></a>
  </div>

  <div class="side-menu">
    <div class="menu-header">Smart Home</div>
    
    
    <a href="#" class="menu-item menu-item-active"><i ></i>Home</a>
    <a href="/overview" class="menu-item"><i class="fas fa-chart-bar fa-lg"></i>Addit</a>
    <a href="/charts" class="menu-item"><i class="fas fa-tachometer-alt fa-lg"></i>Dash</a>
    {% if not is_guest %}
    <a href="/settings" class="menu-item"><i class="fas fa-gear fa-lg"></i>Settings</a>
    {% endif %}
    {% if hello_username == 'Guest' %}
      <a href="/login" action="/login" class="menu-item"><i class="fas fa-sign-in-alt fa-lg"></i>Log In</a>
    {% else %}
      <a href="/logout" class="menu-item"><i class="fas fa-sign-out-alt fa-lg"></i>Log Out</a>
    {% endif %}
  </div>
  <div class="content">
    <h3 class="heading">Hey, {{ hello_username }} üëã Yur device is <span id="status" data-status="{{ status }}">{{ status }}</span></h3>
    <hr class="rounded">
    <div class="upGrid">
    
    
    </div>
    <div class="grid">
      <div class="big-card">
        <h2>AHSGFAJ</h2>
        <p id="date-time"></p>
      </div>
    </div>
    
     <!-- <div class="big-card">
        <h2>–ü–æ–≥–æ–¥–∞</h2>
        <img id="weather-icon" src="weather-icon.png" alt="–ò–∫–æ–Ω–∫–∞ –ø–æ–≥–æ–¥—ã">
        <p id="weather-description"></p>
        <p id="temperature"></p>
    </div>
     -->
    <div class="grid">

      {% for sensor, data in sensor_data.items() %}
        <div class="card">
          <i class="f7-icons icon-in-card">{{ data.icon }}</i>
          <h3 class="text">{{ sensor }}</h3>
          <p class="text">Value: <span id="{{ sensor }}Value">{{ data.value }}</span> {{ data.unit }}</p>
        </div>
      {% endfor %}
    </div>
    
  </div>

  <script>
    var status = document.getElementById("status").getAttribute("data-status");

    function updateData() {
      if (status !== "Offline") {
        fetch('/data')
          .then(response => {
            if (response.ok) {
              return response.json();
            } else {
              throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
          })
          .then(data => {
            Object.keys(data).forEach(sensor => {
              document.getElementById(`${sensor}Value`).innerText = data[sensor].value;
            });
  
            var canvas = document.getElementById("canvas");
            chartify(canvas, data);
  
            var settings = {
              "backgroundColor": "#333333", 
              "chartColor": "#cdb3d5",
              "chartLinesColor": "#fff",
              "textColor": "#fff"
            };
          })
          .catch(error => {
            console.error(error);
          });
      }
    }
    updateData();
    setInterval(updateData, 5500);
  </script>
  <script>
    function updateDateTime() {
      const dateTimeElement = document.getElementById("date-time");
      const now = new Date();
      const options = {
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "numeric",
        minute: "numeric",
      };
      dateTimeElement.textContent = now.toLocaleDateString("en-US", options);
    }


    updateDateTime();

    setInterval(updateDateTime, 1000);

      
    async function getWeather() {
     // const weatherAPIKey = 2b7f609a11610104bafd800647e21720;
      const city = Dnipro; 

      const response = await fetch(
       // `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${weatherAPIKey}&units=metric`
      );
      const data = await response.json();

      const weatherIconElement = document.getElementById("weather-icon");
      const weatherDescriptionElement = document.getElementById("weather-description");
      const temperatureElement = document.getElementById("temperature");

      weatherIconElement.src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
      weatherDescriptionElement.textContent = data.weather[0].description;
      temperatureElement.textContent = `${data.main.temp}¬∞C`;
    }

 
    getWeather();








    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    if (!("Notification" in window))
        alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.");
    else if (Notification.permission !== "granted") {
        // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        Notification.requestPermission().then(function(permission) {
            if (permission === "granted") {
                // –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
                setInterval(function() {
                    updateIValue();
                }, 10000);
            }
        });
    } else {
        // –ï—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —É–∂–µ –µ—Å—Ç—å, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª
        setInterval(function() {
            updateIValue();
        }, 10000);
    }

    // –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π I
    var i_value = 25;

    function updateIValue() {
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π I
        i_value += 10;

        // –£—Å–ª–æ–≤–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        if (i_value > 30) {
            notifyMe();
        }
    }

    function notifyMe() {
        // –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        var notification = new Notification("–í—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—à—å?", {
            tag: "ache-mail",
            body: "–ü–æ—Ä–∞ —Å–¥–µ–ª–∞—Ç—å –ø–∞—É–∑—É –∏ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å",
            icon: "https://itproger.com/img/notify.png"
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—é
        notification.onclick = function() {
            console.log("–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±—ã–ª–æ –∫–ª–∏–∫–Ω—É—Ç–æ.");
        };
    }
</script>
</body>
</html>
